{"version":3,"file":"js-data-redis.js","sources":["../src/index.js"],"sourcesContent":["import redis from 'redis'\nimport {\n  Query,\n  utils\n} from 'js-data'\nimport Adapter from 'js-data-adapter'\nimport underscore from 'mout/string/underscore'\nimport guid from 'mout/random/guid'\n\nfunction getPath (mapper) {\n  if (mapper) {\n    return mapper.table || underscore(mapper.name)\n  }\n}\n\nconst DEFAULTS = {\n  /**\n   * Redis host.\n   *\n   * @name RedisAdapter#host\n   * @type {string}\n   * @default \"127.0.0.1\"\n   */\n  host: '127.0.0.1',\n\n  /**\n   * Redis port.\n   *\n   * @name RedisAdapter#port\n   * @type {number}\n   * @default 6379\n   */\n  port: 6379\n}\n\n/**\n * RedisAdapter class.\n *\n * @example\n * // Use Container instead of DataStore on the server\n * import {Container} from 'js-data'\n * import RedisAdapter from 'js-data-redis'\n *\n * // Create a store to hold your Mappers\n * const store = new Container()\n *\n * // Create an instance of RedisAdapter with default settings\n * const adapter = new RedisAdapter()\n *\n * // Mappers in \"store\" will use the Redis adapter by default\n * store.registerAdapter('redis', adapter, { default: true })\n *\n * // Create a Mapper that maps to a \"user\" table\n * store.defineMapper('user')\n *\n * @class RedisAdapter\n * @extends Adapter\n * @param {Object} [opts] Configuration opts.\n * @param {boolean} [opts.debug=false] Whether to log debugging information.\n * @param {boolean} [opts.raw=false] Whether to return a more detailed response object.\n */\nfunction RedisAdapter (opts) {\n  const self = this\n  utils.classCallCheck(self, RedisAdapter)\n  opts || (opts = {})\n  utils.fillIn(opts, DEFAULTS)\n  Adapter.call(self, opts)\n\n  /**\n   * The Redis client used by this adapter. Use this directly when you need to\n   * write custom queries.\n   *\n   * @name RedisAdapter#client\n   * @type {Object}\n   */\n  self.client = redis.createClient(opts.port, opts.host, opts)\n}\n\n// Setup prototype inheritance from Adapter\nRedisAdapter.prototype = Object.create(Adapter.prototype, {\n  constructor: {\n    value: RedisAdapter,\n    enumerable: false,\n    writable: true,\n    configurable: true\n  }\n})\n\nObject.defineProperty(RedisAdapter, '__super__', {\n  configurable: true,\n  value: Adapter\n})\n\n/**\n * Alternative to ES6 class syntax for extending `RedisAdapter`.\n *\n * @name RedisAdapter.extend\n * @method\n * @param {Object} [instanceProps] Properties that will be added to the\n * prototype of the RedisAdapter.\n * @param {Object} [classProps] Properties that will be added as static\n * properties to the RedisAdapter itself.\n * @return {Object} RedisAdapter of `RedisAdapter`.\n */\nRedisAdapter.extend = utils.extend\n\nutils.addHiddenPropsToTarget(RedisAdapter.prototype, {\n  getIds (mapper) {\n    const self = this\n    return new Promise(function (resolve, reject) {\n      return self.client.SMEMBERS(getPath(mapper), function (err, ids) {\n        if (err) {\n          return reject(err)\n        }\n        return resolve(ids.filter(function (id) {\n          return id !== 'undefined'\n        }))\n      })\n    })\n  },\n\n  GET (path) {\n    const self = this\n    return new Promise(function (resolve, reject) {\n      return self.client.GET(path, function (err, value) {\n        return err ? reject(err) : resolve(utils.isUndefined(value) ? value : JSON.parse(value))\n      })\n    })\n  },\n\n  _count (mapper, query) {\n    const self = this\n    return self._findAll(mapper, query).then(function (result) {\n      result[0] = result[0].length\n      return result\n    })\n  },\n\n  _create (mapper, props) {\n    const self = this\n    const idAttribute = mapper.idAttribute\n    props || (props = {})\n    props = utils.plainCopy(props)\n\n    let id = utils.get(props, idAttribute)\n    if (utils.isUndefined(id)) {\n      id = guid()\n      utils.set(props, idAttribute, id)\n    }\n\n    return new Promise(function (resolve, reject) {\n      props = JSON.stringify(props)\n      return self.client\n        .multi()\n        .set(`${getPath(mapper)}-${id}`, props)\n        .SADD(getPath(mapper), id)\n        .exec(function (err) {\n          return err ? reject(err) : resolve([JSON.parse(props), {}])\n        })\n    })\n  },\n\n  _createMany (mapper, props) {\n    const self = this\n    const idAttribute = mapper.idAttribute\n    props || (props = [])\n    props = utils.plainCopy(props)\n\n    const _path = getPath(mapper)\n    return Promise.all(props.map(function (_props) {\n      return new Promise(function (resolve, reject) {\n        let id = utils.get(_props, idAttribute)\n        if (utils.isUndefined(id)) {\n          id = guid()\n          utils.set(_props, idAttribute, id)\n        }\n        _props = JSON.stringify(_props)\n        return self.client\n          .multi()\n          .set(`${_path}-${id}`, _props)\n          .SADD(_path, id)\n          .exec(function (err) {\n            return err ? reject(err) : resolve(JSON.parse(_props))\n          })\n      })\n    })).then(function (records) {\n      return [records, {}]\n    })\n  },\n\n  _destroy (mapper, id) {\n    const self = this\n\n    return new Promise(function (resolve, reject) {\n      return self.client\n        .multi()\n        .DEL(`${getPath(mapper)}-${id}`)\n        .SREM(getPath(mapper), id)\n        .exec(function (err) {\n          return err ? reject(err) : resolve([undefined, {}])\n        })\n    })\n  },\n\n  _destroyAll (mapper, query) {\n    const self = this\n\n    return self.findAll(mapper, query, { raw: false }).then(function (records) {\n      const _path = getPath(mapper)\n      const idAttribute = mapper.idAttribute\n      return Promise.all(records.map(function (record) {\n        return new Promise(function (resolve, reject) {\n          const id = utils.get(record, idAttribute)\n          return self.client\n            .multi()\n            .DEL(`${_path}-${id}`)\n            .SREM(_path, id)\n            .exec(function (err) {\n              return err ? reject(err) : resolve()\n            })\n        })\n      }))\n    }).then(function () {\n      return [undefined, {}]\n    })\n  },\n\n  _find (mapper, id) {\n    return this.GET(`${getPath(mapper)}-${id}`).then(function (record) {\n      return [record, {}]\n    })\n  },\n\n  _findAll (mapper, query) {\n    const self = this\n    query || (query = {})\n\n    return self.getIds(mapper).then(function (ids) {\n      const path = getPath(mapper)\n      return Promise.all(ids.map(function (id) {\n        return self.GET(`${path}-${id}`)\n      }))\n    }).then(function (_records) {\n      const _query = new Query({\n        index: {\n          getAll () {\n            return _records\n          }\n        }\n      })\n      return [_query.filter(query).run(), {}]\n    })\n  },\n\n  _sum (mapper, field, query) {\n    const self = this\n    return self._findAll(mapper, query).then(function (result) {\n      let sum = 0\n      result[0].forEach(function (record) {\n        sum += utils.get(record, field) || 0\n      })\n      result[0] = sum\n      return result\n    })\n  },\n\n  _updateHelper (mapper, records, props) {\n    const self = this\n    const idAttribute = mapper.idAttribute\n    const _path = getPath(mapper)\n    if (utils.isObject(records) && !utils.isArray(records)) {\n      records = [records]\n    }\n    return Promise.all(records.map(function (record) {\n      utils.deepMixIn(record, props)\n      return new Promise(function (resolve, reject) {\n        self.client.set(`${_path}-${record[idAttribute]}`, JSON.stringify(record), function (err) {\n          return err ? reject(err) : resolve(record)\n        })\n      })\n    }))\n  },\n\n  _update (mapper, id, props) {\n    const self = this\n    props || (props = {})\n\n    return self.GET(`${getPath(mapper)}-${id}`).then(function (record) {\n      if (!record) {\n        throw new Error('Not Found')\n      }\n      return self._updateHelper(mapper, record, props)\n    }).then(function (records) {\n      return [records[0], {}]\n    })\n  },\n\n  _updateAll (mapper, props, query) {\n    const self = this\n    props || (props = {})\n    query || (query = {})\n\n    return self.findAll(mapper, query, { raw: false }).then(function (records) {\n      return self._updateHelper(mapper, records, props)\n    }).then(function (records) {\n      return [records, {}]\n    })\n  },\n\n  _updateMany (mapper, records) {\n    const self = this\n    const idAttribute = mapper.idAttribute\n    const _path = getPath(mapper)\n    records || (records = [])\n\n    return Promise.all(records.map(function (record) {\n      return self.GET(`${_path}-${utils.get(record, idAttribute)}`).then(function (_record) {\n        if (!_record) {\n          return\n        }\n        return self._updateHelper(mapper, _record, record).then(function (records) {\n          return records[0]\n        })\n      })\n    })).then(function (records) {\n      return [records.filter(function (record) {\n        return record\n      }), {}]\n    })\n  }\n})\n\nmodule.exports = RedisAdapter\n"],"names":["utils","Query"],"mappings":"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"}