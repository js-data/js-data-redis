{"version":3,"file":"js-data-redis.js","sources":["../src/index.js"],"sourcesContent":["import redis from 'redis'\nimport {\n  Query,\n  utils\n} from 'js-data'\nimport {Adapter} from 'js-data-adapter'\nimport underscore from 'mout/string/underscore'\nimport guid from 'mout/random/guid'\n\nfunction getPath (mapper) {\n  if (mapper) {\n    return mapper.table || underscore(mapper.name)\n  }\n}\n\nconst DEFAULTS = {\n  /**\n   * Redis host.\n   *\n   * @name RedisAdapter#host\n   * @type {string}\n   * @default \"127.0.0.1\"\n   */\n  host: '127.0.0.1',\n\n  /**\n   * Redis port.\n   *\n   * @name RedisAdapter#port\n   * @type {number}\n   * @default 6379\n   */\n  port: 6379\n}\n\n/**\n * RedisAdapter class.\n *\n * @example\n * // Use Container instead of DataStore on the server\n * import {Container} from 'js-data'\n * import RedisAdapter from 'js-data-redis'\n *\n * // Create a store to hold your Mappers\n * const store = new Container()\n *\n * // Create an instance of RedisAdapter with default settings\n * const adapter = new RedisAdapter()\n *\n * // Mappers in \"store\" will use the Redis adapter by default\n * store.registerAdapter('redis', adapter, { default: true })\n *\n * // Create a Mapper that maps to a \"user\" table\n * store.defineMapper('user')\n *\n * @class RedisAdapter\n * @extends Adapter\n * @param {Object} [opts] Configuration options.\n * @param {boolean} [opts.debug=false] See {@link Adapter#debug}.\n * @param {boolean} [opts.host=\"127.0.0.1\"] See {@link RedisAdapter#host}.\n * @param {boolean} [opts.port=6379] See {@link RedisAdapter#port}.\n * @param {boolean} [opts.raw=false] See {@link Adapter#raw}.\n */\nexport function RedisAdapter (opts) {\n  const self = this\n  utils.classCallCheck(self, RedisAdapter)\n  opts || (opts = {})\n  utils.fillIn(opts, DEFAULTS)\n  Adapter.call(self, opts)\n\n  /**\n   * The Redis client used by this adapter. Use this directly when you need to\n   * write custom queries.\n   *\n   * @name RedisAdapter#client\n   * @type {Object}\n   */\n  self.client = redis.createClient(opts.port, opts.host, opts)\n}\n\n// Setup prototype inheritance from Adapter\nRedisAdapter.prototype = Object.create(Adapter.prototype, {\n  constructor: {\n    value: RedisAdapter,\n    enumerable: false,\n    writable: true,\n    configurable: true\n  }\n})\n\nObject.defineProperty(RedisAdapter, '__super__', {\n  configurable: true,\n  value: Adapter\n})\n\n/**\n * Alternative to ES6 class syntax for extending `RedisAdapter`.\n *\n * @example <caption>Using the ES2015 class syntax.</caption>\n * class MyRedisAdapter extends RedisAdapter {...}\n * const adapter = new MyRedisAdapter()\n *\n * @example <caption>Using {@link RedisAdapter.extend}.</caption>\n * var instanceProps = {...}\n * var classProps = {...}\n *\n * var MyRedisAdapter = RedisAdapter.extend(instanceProps, classProps)\n * var adapter = new MyRedisAdapter()\n *\n * @method RedisAdapter.extend\n * @static\n * @param {Object} [instanceProps] Properties that will be added to the\n * prototype of the subclass.\n * @param {Object} [classProps] Properties that will be added as static\n * properties to the subclass itself.\n * @return {Constructor} Subclass of `RedisAdapter`.\n */\nRedisAdapter.extend = utils.extend\n\nutils.addHiddenPropsToTarget(RedisAdapter.prototype, {\n  getIds (mapper) {\n    const self = this\n    return new Promise(function (resolve, reject) {\n      return self.client.SMEMBERS(getPath(mapper), function (err, ids) {\n        if (err) {\n          return reject(err)\n        }\n        return resolve(ids.filter(function (id) {\n          return id !== 'undefined'\n        }))\n      })\n    })\n  },\n\n  GET (path) {\n    const self = this\n    return new Promise(function (resolve, reject) {\n      return self.client.GET(path, function (err, value) {\n        return err ? reject(err) : resolve(utils.isUndefined(value) ? value : JSON.parse(value))\n      })\n    })\n  },\n\n  _count (mapper, query) {\n    const self = this\n    return self._findAll(mapper, query).then(function (result) {\n      result[0] = result[0].length\n      return result\n    })\n  },\n\n  _create (mapper, props) {\n    const self = this\n    const idAttribute = mapper.idAttribute\n    props || (props = {})\n    props = utils.plainCopy(props)\n\n    let id = utils.get(props, idAttribute)\n    if (utils.isUndefined(id)) {\n      id = guid()\n      utils.set(props, idAttribute, id)\n    }\n\n    return new Promise(function (resolve, reject) {\n      props = JSON.stringify(props)\n      return self.client\n        .multi()\n        .set(`${getPath(mapper)}-${id}`, props)\n        .SADD(getPath(mapper), id)\n        .exec(function (err) {\n          return err ? reject(err) : resolve([JSON.parse(props), {}])\n        })\n    })\n  },\n\n  _createMany (mapper, props) {\n    const self = this\n    const idAttribute = mapper.idAttribute\n    props || (props = [])\n    props = utils.plainCopy(props)\n\n    const _path = getPath(mapper)\n    return Promise.all(props.map(function (_props) {\n      return new Promise(function (resolve, reject) {\n        let id = utils.get(_props, idAttribute)\n        if (utils.isUndefined(id)) {\n          id = guid()\n          utils.set(_props, idAttribute, id)\n        }\n        _props = JSON.stringify(_props)\n        return self.client\n          .multi()\n          .set(`${_path}-${id}`, _props)\n          .SADD(_path, id)\n          .exec(function (err) {\n            return err ? reject(err) : resolve(JSON.parse(_props))\n          })\n      })\n    })).then(function (records) {\n      return [records, {}]\n    })\n  },\n\n  _destroy (mapper, id) {\n    const self = this\n\n    return new Promise(function (resolve, reject) {\n      return self.client\n        .multi()\n        .DEL(`${getPath(mapper)}-${id}`)\n        .SREM(getPath(mapper), id)\n        .exec(function (err) {\n          return err ? reject(err) : resolve([undefined, {}])\n        })\n    })\n  },\n\n  _destroyAll (mapper, query) {\n    const self = this\n\n    return self.findAll(mapper, query, { raw: false }).then(function (records) {\n      const _path = getPath(mapper)\n      const idAttribute = mapper.idAttribute\n      return Promise.all(records.map(function (record) {\n        return new Promise(function (resolve, reject) {\n          const id = utils.get(record, idAttribute)\n          return self.client\n            .multi()\n            .DEL(`${_path}-${id}`)\n            .SREM(_path, id)\n            .exec(function (err) {\n              return err ? reject(err) : resolve()\n            })\n        })\n      }))\n    }).then(function () {\n      return [undefined, {}]\n    })\n  },\n\n  _find (mapper, id) {\n    return this.GET(`${getPath(mapper)}-${id}`).then(function (record) {\n      return [record, {}]\n    })\n  },\n\n  _findAll (mapper, query) {\n    const self = this\n    query || (query = {})\n\n    return self.getIds(mapper).then(function (ids) {\n      const path = getPath(mapper)\n      return Promise.all(ids.map(function (id) {\n        return self.GET(`${path}-${id}`)\n      }))\n    }).then(function (_records) {\n      const _query = new Query({\n        index: {\n          getAll () {\n            return _records\n          }\n        }\n      })\n      return [_query.filter(query).run(), {}]\n    })\n  },\n\n  _sum (mapper, field, query) {\n    const self = this\n    return self._findAll(mapper, query).then(function (result) {\n      let sum = 0\n      result[0].forEach(function (record) {\n        sum += utils.get(record, field) || 0\n      })\n      result[0] = sum\n      return result\n    })\n  },\n\n  _updateHelper (mapper, records, props) {\n    const self = this\n    const idAttribute = mapper.idAttribute\n    const _path = getPath(mapper)\n    if (utils.isObject(records) && !utils.isArray(records)) {\n      records = [records]\n    }\n    return Promise.all(records.map(function (record) {\n      utils.deepMixIn(record, props)\n      return new Promise(function (resolve, reject) {\n        self.client.set(`${_path}-${record[idAttribute]}`, JSON.stringify(record), function (err) {\n          return err ? reject(err) : resolve(record)\n        })\n      })\n    }))\n  },\n\n  _update (mapper, id, props) {\n    const self = this\n    props || (props = {})\n\n    return self.GET(`${getPath(mapper)}-${id}`).then(function (record) {\n      if (!record) {\n        throw new Error('Not Found')\n      }\n      return self._updateHelper(mapper, record, props)\n    }).then(function (records) {\n      return [records[0], {}]\n    })\n  },\n\n  _updateAll (mapper, props, query) {\n    const self = this\n    props || (props = {})\n    query || (query = {})\n\n    return self.findAll(mapper, query, { raw: false }).then(function (records) {\n      return self._updateHelper(mapper, records, props)\n    }).then(function (records) {\n      return [records, {}]\n    })\n  },\n\n  _updateMany (mapper, records) {\n    const self = this\n    const idAttribute = mapper.idAttribute\n    const _path = getPath(mapper)\n    records || (records = [])\n\n    return Promise.all(records.map(function (record) {\n      return self.GET(`${_path}-${utils.get(record, idAttribute)}`).then(function (_record) {\n        if (!_record) {\n          return\n        }\n        return self._updateHelper(mapper, _record, record).then(function (records) {\n          return records[0]\n        })\n      })\n    })).then(function (records) {\n      return [records.filter(function (record) {\n        return record\n      }), {}]\n    })\n  }\n})\n\n/**\n * Details of the current version of the `js-data-redis` module.\n *\n * @example\n * import {version} from 'js-data-redis'\n * console.log(version.full)\n *\n * @name module:js-data-redis.version\n * @type {Object}\n * @property {string} version.full The full semver value.\n * @property {number} version.major The major version number.\n * @property {number} version.minor The minor version number.\n * @property {number} version.patch The patch version number.\n * @property {(string|boolean)} version.alpha The alpha version value,\n * otherwise `false` if the current version is not alpha.\n * @property {(string|boolean)} version.beta The beta version value,\n * otherwise `false` if the current version is not beta.\n */\nexport const version = '<%= version %>'\n\n/**\n * {@link RedisAdapter} class.\n *\n * @example\n * import {RedisAdapter} from 'js-data-redis'\n * const adapter = new RedisAdapter()\n *\n * @name module:js-data-redis.RedisAdapter\n * @see RedisAdapter\n * @type {Constructor}\n */\n\n/**\n * Registered as `js-data-redis` in NPM.\n *\n * @example <caption>Install from NPM</caption>\n * npm i --save js-data-redis@beta js-data@beta redis\n *\n * @example <caption>Load via CommonJS</caption>\n * var RedisAdapter = require('js-data-redis').RedisAdapter\n * var adapter = new RedisAdapter()\n *\n * @example <caption>Load via ES2015 Modules</caption>\n * import {RedisAdapter} from 'js-data-redis'\n * const adapter = new RedisAdapter()\n *\n * @module js-data-redis\n */\n\nexport default RedisAdapter\n"],"names":["Adapter","utils","Query"],"mappings":"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"}